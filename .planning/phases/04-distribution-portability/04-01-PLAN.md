---
phase: 04-distribution-portability
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - agents/mow-debugger.md
  - agents/mow-executor.md
  - agents/mow-phase-researcher.md
  - agents/mow-plan-checker.md
  - agents/mow-planner.md
  - agents/mow-project-researcher.md
  - agents/mow-research-synthesizer.md
  - agents/mow-roadmapper.md
  - agents/mow-verifier.md
  - commands/mow/*.md
  - mowism/references/*.md
  - mowism/templates/*.md
  - mowism/workflows/*.md
  - .planning/phases/**/*-PLAN.md
  - .planning/phases/**/*-RESEARCH.md
  - .planning/phases/**/*-VERIFICATION.md
  - .planning/phases/**/*-CONTEXT.md
  - .planning/research/ARCHITECTURE.md
  - .planning/ROADMAP.md
  - .planning/v1.0-MILESTONE-AUDIT.md
autonomous: true
requirements:
  - CORE-01
  - CORE-03
  - DIST-01

must_haves:
  truths:
    - "Zero occurrences of /home/max/.claude/ in any file under agents/, commands/, mowism/, or .planning/ (excluding .planning/phases/04-distribution-portability/ where the path appears as documentation text)"
    - "All @-references use ~/.claude/ form (tilde, not $HOME)"
    - "All node invocations use ~/.claude/ form"
    - "Files inside double-quoted bash strings use $HOME instead of ~ where tilde would not expand"
  artifacts:
    - path: "agents/mow-planner.md"
      provides: "Representative agent file with portable paths"
      contains: "~/.claude/mowism/"
    - path: "commands/mow/execute-phase.md"
      provides: "Representative command file with portable paths"
      contains: "~/.claude/mowism/"
    - path: "mowism/workflows/execute-plan.md"
      provides: "Representative workflow file with portable paths"
      contains: "~/.claude/mowism/"
  key_links:
    - from: "commands/mow/*.md"
      to: "mowism/workflows/*.md"
      via: "@-reference paths"
      pattern: "@~/.claude/mowism/workflows/"
    - from: "mowism/workflows/*.md"
      to: "bin/mow-tools.cjs"
      via: "node invocation paths"
      pattern: "node ~/.claude/mowism/bin/mow-tools.cjs"
---

<objective>
Replace all hardcoded `/home/max/.claude/` paths with portable `~/.claude/` across the entire repository.

Purpose: The developer's home directory path is hardcoded in ~107 files (411 occurrences). This means Mowism only works on the developer's machine. Replacing with `~/.claude/` makes it work on any Unix system, matching the pattern GSD upstream uses.

Output: All source files use portable `~/.claude/` paths; zero occurrences of `/home/max/.claude/` remain in the repository.
</objective>

<execution_context>
@~/.claude/mowism/workflows/execute-plan.md
@~/.claude/mowism/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-distribution-portability/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bulk replace /home/max/.claude/ with ~/.claude/ across all source files</name>
  <files>
    agents/*.md
    commands/mow/*.md
    mowism/references/*.md
    mowism/templates/*.md
    mowism/workflows/*.md
    .planning/phases/**/*.md
    .planning/research/ARCHITECTURE.md
    .planning/ROADMAP.md
    .planning/v1.0-MILESTONE-AUDIT.md
  </files>
  <action>
    Run a bulk `sed` replacement from the repo root:

    ```bash
    find . -type f \( -name '*.md' -o -name '*.cjs' -o -name '*.sh' \) \
      -not -path './.git/*' \
      -not -path './.planning/phases/04-distribution-portability/*' \
      -exec sed -i 's|/home/max/\.claude/|~/.claude/|g' {} +
    ```

    This replaces ALL ~411 occurrences across ~107 files in a single pass. The `sed` delimiter is `|` to avoid escaping slashes. The escaped `\.` ensures only literal dots match.

    **Why exclude Phase 4 plan files:** The files in `.planning/phases/04-distribution-portability/` contain `/home/max/.claude/` as documentation text (task names, objectives, success criteria describing the replacement work). Sed-replacing these would garble the plans' own historical record (e.g., the objective "Replace all hardcoded `/home/max/.claude/` paths" would become "Replace all hardcoded `~/.claude/` paths" -- losing context about what was actually being fixed).

    **Important edge case:** After the bulk replacement, check for any `~` inside double-quoted bash strings where tilde would NOT expand. These need `$HOME` instead. Search with:

    ```bash
    grep -n '"~/.claude/' . -r --include='*.md' --include='*.cjs'
    ```

    If any matches appear inside bash variable assignments like `VAR="~/.claude/..."`, change those specific occurrences to `$HOME/.claude/...`. Based on research, `help-open.md` already uses `$HOME` correctly; the bulk sed should not introduce this issue because `/home/max/.claude/` appears in unquoted contexts, but verify anyway.

    **Do NOT modify:** `bin/mow-tools.cjs` or `bin/mow-tools.test.cjs` (Plan 04-02 handles those). However, the sed command above targets `*.cjs` files -- verify that `/home/max/.claude/` does not appear in those files (it should not, since mow-tools.cjs uses `os.homedir()` at runtime). If the sed touches them harmlessly (no matches), that is fine.

    After the replacement, run `git diff --stat` to verify the scope matches expectations (~107 files changed).
  </action>
  <verify>
    ```bash
    # Must return 0 lines (excludes Phase 4 plan files which contain the path as documentation)
    grep -r '/home/max/.claude/' . --include='*.md' --include='*.cjs' --include='*.sh' | grep -v '.git/' | grep -v '.planning/phases/04-distribution-portability/' | wc -l

    # Must return 0 lines (no tilde inside double-quoted bash assignments)
    grep -rn '"~/.claude/' . --include='*.md' --include='*.cjs' | grep -v '.git/'

    # Verify changed file count is reasonable (~107 files)
    git diff --stat | tail -1
    ```
  </verify>
  <done>Zero occurrences of `/home/max/.claude/` in any `.md`, `.cjs`, or `.sh` file in the repository. Zero occurrences of tilde inside double-quoted bash strings. `git diff --stat` shows ~107 files changed.</done>
</task>

<task type="auto">
  <name>Task 2: Verify @-references and node invocations are syntactically correct</name>
  <files>
    commands/mow/*.md
    mowism/workflows/*.md
    agents/*.md
  </files>
  <action>
    After the bulk replacement, do a targeted spot-check to confirm the substitution produced correct syntax in the three critical path categories:

    1. **@-references** (155 occurrences): Sample 5-10 files and confirm the pattern is `@~/.claude/mowism/...` (no double tildes, no missing slashes, no broken syntax). Example:
       ```bash
       grep -h '@~/.claude/mowism/' commands/mow/execute-phase.md mowism/workflows/execute-plan.md agents/mow-planner.md | head -10
       ```

    2. **node invocations** (182 occurrences): Sample 5-10 files and confirm the pattern is `node ~/.claude/mowism/bin/mow-tools.cjs ...`. Example:
       ```bash
       grep -h 'node ~/.claude/mowism/bin/mow-tools.cjs' mowism/workflows/execute-phase.md mowism/workflows/plan-phase.md mowism/workflows/new-project.md | head -10
       ```

    3. **Other references** (74 occurrences): Sample references in templates, references, and .planning/ artifacts to confirm they read correctly. Example:
       ```bash
       grep -h '~/.claude/mowism/' mowism/references/git-planning-commit.md mowism/templates/phase-prompt.md | head -10
       ```

    If any output shows malformed paths (double tildes `~~`, missing directory component, broken markdown syntax), fix those specific occurrences manually.
  </action>
  <verify>
    ```bash
    # Spot-check: @-references should look like @~/.claude/mowism/...
    grep -c '@~/.claude/mowism/' commands/mow/*.md mowism/workflows/*.md | grep -v ':0$' | wc -l

    # Spot-check: node invocations should look like node ~/.claude/mowism/bin/mow-tools.cjs
    grep -c 'node ~/.claude/mowism/bin/mow-tools.cjs' mowism/workflows/*.md | grep -v ':0$' | wc -l

    # Both counts should be non-zero, confirming the pattern is present and well-formed
    ```
  </verify>
  <done>Sampled @-references, node invocations, and other references all show correct `~/.claude/mowism/` syntax. No malformed paths found.</done>
</task>

</tasks>

<verification>
```bash
# Final verification: absolute zero occurrences of the hardcoded .claude/ path (excluding Phase 4 plan docs)
grep -r '/home/max/.claude/' . --include='*.md' --include='*.cjs' --include='*.sh' | grep -v '.git/' | grep -v '.planning/phases/04-distribution-portability/'
# Expected: no output

# Confirm portable paths are present
grep -rc '~/.claude/mowism/' agents/ commands/ mowism/ | grep -v ':0$' | wc -l
# Expected: ~80+ files with portable paths
```
</verification>

<success_criteria>
1. Zero occurrences of `/home/max/.claude/` in any file in the repository (excluding Phase 4 plan files where it appears as documentation text)
2. All @-references use `~/.claude/` form
3. All node invocations use `~/.claude/` form
4. No tilde used inside double-quoted bash strings (those use $HOME)
5. `git diff --stat` confirms ~107 files changed
</success_criteria>

<output>
After completion, create `.planning/phases/04-distribution-portability/04-01-SUMMARY.md`
</output>
