---
phase: 15-full-lifecycle-workers
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bin/mow-tools.cjs
  - bin/mow-tools.test.cjs
autonomous: true
requirements:
  - WORK-04
  - WORK-07

must_haves:
  truths:
    - "init phase-op returns summary_count so workers can compare summaries vs plans for resume detection"
    - "config-get worker.stage_gates returns 'none' as default when not explicitly set"
    - "config-get workflow.verifier returns true as default when not explicitly set"
    - "All new fields are tested with passing assertions"
  artifacts:
    - path: "bin/mow-tools.cjs"
      provides: "summary_count in init phase-op output, config defaults for worker.stage_gates and workflow.verifier"
      contains: "summary_count"
    - path: "bin/mow-tools.test.cjs"
      provides: "Test coverage for new fields"
      contains: "summary_count"
  key_links:
    - from: "bin/mow-tools.cjs (cmdInitPhaseOp)"
      to: "findPhaseInternal"
      via: "summaries.length already computed internally"
      pattern: "summary_count.*summaries"
---

<objective>
Add worker-lifecycle support fields to mow-tools.cjs: summary_count in init phase-op output for artifact-based resume detection, and config defaults for worker.stage_gates and workflow.verifier.

Purpose: Workers need summary_count to determine execute-stage completion (plan_count vs summary_count comparison). Stage gates and verifier config support the configurable autonomy model. These are prerequisites for the worker rewrite in Plan 02.

Output: Updated mow-tools.cjs with new fields and matching test coverage.
</objective>

<execution_context>
@~/.claude/mowism/workflows/execute-plan.md
@~/.claude/mowism/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@bin/mow-tools.cjs
@bin/mow-tools.test.cjs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add summary_count to init phase-op and config defaults</name>
  <files>bin/mow-tools.cjs</files>
  <action>
  In `cmdInitPhaseOp()` function (around line 6370), add `summary_count` to the result object. The internal `findPhaseInternal()` already computes `phaseInfo.summaries` — just add:
  ```
  summary_count: phaseInfo?.summaries?.length || 0,
  ```
  Place it right after the `plan_count` field in the result object.

  Also add the same field to the fallback object (around line 6354 where phaseInfo is constructed from roadmap data) — set `summaries: []` there so the fallback path works.

  For config defaults: add entries to the `CONFIG_DEFAULTS` constant (line 1355 in bin/mow-tools.cjs). This is the fallback object that `cmdConfigGet()` consults when a key is not found in config.json. Add:
  - `worker: { stage_gates: 'none' }` — default to fully autonomous after discuss
  - `workflow: { verifier: true }` — if workflow already exists in CONFIG_DEFAULTS, merge into it; otherwise add it

  Do NOT modify `loadConfig()` — it is unrelated to config-get defaults. These are simple property additions to the CONFIG_DEFAULTS object — no new functions, no new commands.
  </action>
  <verify>
  ```bash
  node bin/mow-tools.cjs init phase-op 15 --raw 2>/dev/null | python3 -c "import sys,json; d=json.load(sys.stdin); assert 'summary_count' in d, 'summary_count missing'; print('OK: summary_count =', d['summary_count'])"
  STAGE_GATES=$(node bin/mow-tools.cjs config-get worker.stage_gates 2>/dev/null) && [ "$STAGE_GATES" = "none" ] && echo "OK: worker.stage_gates = none" || { echo "FAIL: expected 'none', got '$STAGE_GATES'"; exit 1; }
  VERIFIER=$(node bin/mow-tools.cjs config-get workflow.verifier 2>/dev/null) && [ "$VERIFIER" = "true" ] && echo "OK: workflow.verifier = true" || { echo "FAIL: expected 'true', got '$VERIFIER'"; exit 1; }
  ```
  </verify>
  <done>init phase-op returns summary_count field. config-get worker.stage_gates returns "none" by default.</done>
</task>

<task type="auto">
  <name>Task 2: Add test coverage for new fields</name>
  <files>bin/mow-tools.test.cjs</files>
  <action>
  Add tests to mow-tools.test.cjs for the new functionality:

  1. **init phase-op summary_count test:** In the existing `init phase-op` test group, add a test that verifies `summary_count` appears in the output JSON and is a number. Use an existing phase with known SUMMARYs (e.g., phase 13 which has 5 summaries) or create a temp phase fixture.

  2. **Config defaults test:** Add a test verifying that `worker.stage_gates` defaults to `"none"` when not explicitly set in config.json. This can be a simple test that loads config from a temp directory without a config.json and checks the default.

  Follow the existing test patterns in the file (they use Node's built-in test runner with `describe`/`it`/`assert`).
  </action>
  <verify>
  ```bash
  cd /home/max/git/mowism && node --test bin/mow-tools.test.cjs 2>&1 | tail -5
  ```
  All tests pass including new ones.
  </verify>
  <done>New tests for summary_count and config defaults pass. No existing tests broken.</done>
</task>

</tasks>

<verification>
1. `node bin/mow-tools.cjs init phase-op 13 --raw` includes `summary_count: 5` (phase 13 has 5 summaries)
2. `node bin/mow-tools.cjs init phase-op 15 --raw` includes `summary_count: 0` (phase 15 has no summaries)
3. `node bin/mow-tools.cjs config-get worker.stage_gates` returns `none`
4. Full test suite passes: `node --test bin/mow-tools.test.cjs`
</verification>

<success_criteria>
- init phase-op JSON output includes summary_count integer field
- Config system returns worker.stage_gates default of "none"
- All existing tests continue to pass
- New tests validate the additions
</success_criteria>

<output>
After completion, create `.planning/phases/15-full-lifecycle-workers/15-01-SUMMARY.md`
</output>
