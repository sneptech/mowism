---
phase: 06-cleanup-orphaned-workflows
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mowism/workflows/_archive/discovery-phase.md
  - mowism/workflows/_archive/verify-phase.md
  - mowism/templates/roadmap.md
  - mowism/templates/phase-prompt.md
  - .planning/ROADMAP.md
autonomous: true
requirements:
  - "CORE-01 (fix)"

must_haves:
  truths:
    - "discovery-phase.md and verify-phase.md are in _archive/ with explanatory headers (not in active workflows/)"
    - "No active source file (outside .planning/ and _archive/) references discovery-phase or verify-phase"
    - "ROADMAP.md Phase 4 plans show [x] checkboxes (04-01, 04-02, 04-03)"
    - "ROADMAP.md Phase 5 plan shows [x] checkbox (05-01)"
    - "Installed copies at ~/.claude/mowism/ mirror repo state (archived files moved, templates updated)"
    - "Test suite passes (103/103)"
  artifacts:
    - path: "mowism/workflows/_archive/discovery-phase.md"
      provides: "Archived discovery workflow with header explaining why archived and what replaced it"
      contains: "ARCHIVED"
    - path: "mowism/workflows/_archive/verify-phase.md"
      provides: "Archived verify workflow with header explaining why archived and what replaced it"
      contains: "ARCHIVED"
    - path: "mowism/templates/roadmap.md"
      provides: "Active template with no verify-phase reference"
    - path: "mowism/templates/phase-prompt.md"
      provides: "Active template with no verify-phase.md file reference"
    - path: ".planning/ROADMAP.md"
      provides: "Corrected plan checkboxes for Phases 4, 5, and 6"
  key_links:
    - from: "mowism/workflows/_archive/discovery-phase.md"
      to: "research-phase.md"
      via: "archive header documenting replacement"
      pattern: "replaced_by.*research-phase"
    - from: "mowism/workflows/_archive/verify-phase.md"
      to: "refine-phase.md"
      via: "archive header documenting replacement"
      pattern: "replaced_by.*refine-phase"
---

<objective>
Archive orphaned workflow files, fix stale template references, and correct ROADMAP metadata so the codebase matches its documented state.

Purpose: Closes INT-02 and INT-03 from the v1.0 audit. Two workflow files (discovery-phase.md, verify-phase.md) falsely claim to be called by active workflows but are actually orphaned. ROADMAP plan checkboxes for completed Phases 4 and 5 still show [ ] instead of [x].
Output: Clean codebase with archived workflows, updated templates, and accurate ROADMAP metadata.
</objective>

<execution_context>
@/home/max/.claude/get-shit-done/workflows/execute-plan.md
@/home/max/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-cleanup-orphaned-workflows/06-CONTEXT.md
@.planning/phases/06-cleanup-orphaned-workflows/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Archive orphaned workflows with explanatory headers</name>
  <files>
    mowism/workflows/_archive/discovery-phase.md
    mowism/workflows/_archive/verify-phase.md
  </files>
  <action>
    Create the archive directory and move both orphaned workflow files using git mv to preserve history:

    1. Create `mowism/workflows/_archive/` directory (mkdir -p).

    2. Use `git mv mowism/workflows/discovery-phase.md mowism/workflows/_archive/discovery-phase.md` to move the file.

    3. Read the archived file, then prepend this archive header to discovery-phase.md (before the original content):

    ```
    ---
    archived: 2026-02-20
    reason: Orphaned workflow -- claims to be called from plan-phase.md but no reference exists
    replaced_by: research-phase.md workflow + mow-phase-researcher agent
    phase: 06-cleanup-orphaned-workflows
    audit_ref: INT-02
    ---

    > **ARCHIVED**: This workflow is no longer active. It was archived during Phase 6
    > (cleanup orphaned workflows) because it was never wired into plan-phase.md despite
    > claiming to be called from it. The research and discovery functionality it describes
    > is now covered by `/mow:research-phase` and the `mow-phase-researcher` agent.
    > Kept as a design reference.

    ```

    4. Use `git mv mowism/workflows/verify-phase.md mowism/workflows/_archive/verify-phase.md` to move the file.

    5. Read the archived file, then prepend this archive header to verify-phase.md (before the original content):

    ```
    ---
    archived: 2026-02-20
    reason: Orphaned workflow -- claims to be executed by execute-phase.md but mow-verifier agent is self-contained
    replaced_by: refine-phase.md workflow (tiered quality chain)
    phase: 06-cleanup-orphaned-workflows
    audit_ref: INT-03
    ---

    > **ARCHIVED**: This workflow is no longer active. It was archived during Phase 6
    > (cleanup orphaned workflows) because execute-phase.md spawns the mow-verifier agent
    > with an inline prompt rather than referencing this file. The tiered verification
    > chain it attempted to implement is now fully realized by `/mow:refine-phase`.
    > Kept as a design reference.

    ```

    6. Mirror changes to the installed copy at ~/.claude/mowism/workflows/:
       - `mkdir -p ~/.claude/mowism/workflows/_archive/`
       - `mv ~/.claude/mowism/workflows/discovery-phase.md ~/.claude/mowism/workflows/_archive/discovery-phase.md`
       - `mv ~/.claude/mowism/workflows/verify-phase.md ~/.claude/mowism/workflows/_archive/verify-phase.md`
       - Copy the repo archive files (with headers) over the installed archive files so they match exactly:
         `cp mowism/workflows/_archive/discovery-phase.md ~/.claude/mowism/workflows/_archive/discovery-phase.md`
         `cp mowism/workflows/_archive/verify-phase.md ~/.claude/mowism/workflows/_archive/verify-phase.md`

    IMPORTANT: The installed copy is NOT in git -- use plain mv/cp, not git mv.
  </action>
  <verify>
    - `ls mowism/workflows/_archive/discovery-phase.md mowism/workflows/_archive/verify-phase.md` shows both files exist
    - `ls mowism/workflows/discovery-phase.md 2>&1` shows "No such file" (removed from active dir)
    - `ls mowism/workflows/verify-phase.md 2>&1` shows "No such file" (removed from active dir)
    - `head -5 mowism/workflows/_archive/discovery-phase.md` shows the archive frontmatter
    - `head -5 mowism/workflows/_archive/verify-phase.md` shows the archive frontmatter
    - Same checks for ~/.claude/mowism/workflows/ (files in _archive/, not in parent)
    - `git log --follow --oneline -3 mowism/workflows/_archive/discovery-phase.md` shows history preserved
  </verify>
  <done>Both orphaned files are in _archive/ with archive headers in both repo and installed locations. Original locations are empty. Git history is preserved via git mv.</done>
</task>

<task type="auto">
  <name>Task 2: Fix stale template references and ROADMAP metadata</name>
  <files>
    mowism/templates/roadmap.md
    mowism/templates/phase-prompt.md
    .planning/ROADMAP.md
  </files>
  <action>
    Fix the two active template files that reference the now-archived verify-phase, and correct ROADMAP checkboxes.

    1. **mowism/templates/roadmap.md line 120**: Change:
       `- Verified by verify-phase after execution`
       To:
       `- Verified by execute-phase verification subagent after execution`

    2. **mowism/templates/phase-prompt.md line 569**: Change:
       `See ~/.claude/mowism/workflows/verify-phase.md for verification logic.`
       (Note: the actual path may use the $MOWISM_HOME variable pattern -- read the line first to get exact text)
       To:
       `See the mow-verifier agent definition for verification logic (spawned by execute-phase.md).`

    3. **Mirror template changes to installed copies**:
       - Copy updated `mowism/templates/roadmap.md` to `~/.claude/mowism/templates/roadmap.md`
       - Copy updated `mowism/templates/phase-prompt.md` to `~/.claude/mowism/templates/phase-prompt.md`

    4. **Fix ROADMAP.md Phase 4 checkboxes** (lines ~91-93): Change `[ ]` to `[x]` for:
       - `04-01-PLAN.md`
       - `04-02-PLAN.md`
       - `04-03-PLAN.md`

    5. **Fix ROADMAP.md Phase 5 checkbox** (line ~106): Change `[ ]` to `[x]` for:
       - `05-01-PLAN.md`

    6. **Update ROADMAP.md Phase 6 entry** to reflect this plan:
       - Add plan count: `**Plans:** 1 plan`
       - Add plan list:
         ```
         Plans:
         - [ ] 06-01-PLAN.md -- Archive orphaned workflows + fix stale references and ROADMAP metadata
         ```

    IMPORTANT: Do NOT touch .planning/ historical documents (01-RESEARCH.md, 01-04-PLAN.md, 01-04-SUMMARY.md, ARCHITECTURE.md, v1.0-MILESTONE-AUDIT.md). Per user's discretion decision, these are historical records and remain as-is.
  </action>
  <verify>
    - `grep "verify-phase" mowism/templates/roadmap.md` returns zero matches
    - `grep "verify-phase" mowism/templates/phase-prompt.md` returns zero matches
    - `grep "verify-phase" ~/.claude/mowism/templates/roadmap.md` returns zero matches
    - `grep "verify-phase" ~/.claude/mowism/templates/phase-prompt.md` returns zero matches
    - `grep '\- \[ \] 04-' .planning/ROADMAP.md` returns zero matches (all Phase 4 plans checked)
    - `grep '\- \[ \] 05-' .planning/ROADMAP.md` returns zero matches (all Phase 5 plans checked)
    - `grep '\- \[ \] 06-01' .planning/ROADMAP.md` returns one match (current plan, correctly unchecked)
  </verify>
  <done>Templates reference mow-verifier agent instead of verify-phase.md. ROADMAP shows [x] for all Phase 4 and 5 plans. Phase 6 has its plan listed. Installed template copies match repo.</done>
</task>

<task type="auto">
  <name>Task 3: Full reference sweep and test suite verification</name>
  <files></files>
  <action>
    Run a comprehensive verification sweep to confirm all stale references are resolved and no regressions exist.

    1. **Reference sweep across repo** (excluding .planning/ historical docs, .git/, and _archive/):
       ```bash
       grep -rn "discovery-phase\|verify-phase" \
         --include="*.md" --include="*.cjs" --include="*.sh" \
         /home/max/git/mowism/ \
         | grep -v ".planning/" \
         | grep -v ".git/" \
         | grep -v "_archive/"
       ```
       Expected: ZERO matches. If any matches found, fix them.

    2. **Reference sweep across installed copy** (excluding _archive/):
       ```bash
       grep -rn "discovery-phase\|verify-phase" \
         ~/.claude/mowism/ \
         | grep -v "_archive/"
       ```
       Expected: ZERO matches. If any matches found, fix them.

    3. **Help file check** (explicit confirmation per user decision):
       ```bash
       grep -rn "discovery-phase\|verify-phase" /home/max/git/mowism/help/
       ```
       Expected: ZERO matches. Research confirmed clean, but verify.

    4. **ROADMAP checkbox sanity check**:
       ```bash
       grep '\- \[ \]' .planning/ROADMAP.md
       ```
       Expected: Only Phase 6 plan entry (06-01) should show [ ].

    5. **Run full test suite**:
       ```bash
       cd /home/max/git/mowism && node --test bin/mow-tools.test.cjs
       ```
       Expected: 103/103 tests pass.

    6. If any sweep finds unexpected matches, fix the source file and re-run the sweep. If any test fails, investigate and fix.

    NOTE: Matches in `.planning/` files and `_archive/` files are expected and correct -- do not modify them.
  </action>
  <verify>
    - Reference sweep (step 1) returns zero matches
    - Installed sweep (step 2) returns zero matches
    - Help file sweep (step 3) returns zero matches
    - ROADMAP checkbox grep (step 4) only shows Phase 6's 06-01 entry
    - Test suite (step 5) shows 103/103 pass (or more if new tests were added)
  </verify>
  <done>Full codebase verified clean: zero stale references to orphaned workflows outside historical docs and archives. Test suite passes. ROADMAP metadata is accurate.</done>
</task>

</tasks>

<verification>
After all tasks complete, the following must be true:
1. `mowism/workflows/` contains NO `discovery-phase.md` or `verify-phase.md` (both in `_archive/`)
2. `~/.claude/mowism/workflows/` mirrors the same structure
3. Both archived files have YAML frontmatter with `archived:` and `replaced_by:` fields plus a blockquote explanation
4. `mowism/templates/roadmap.md` and `mowism/templates/phase-prompt.md` contain no "verify-phase" references
5. `~/.claude/mowism/templates/` copies match repo versions
6. `.planning/ROADMAP.md` shows `[x]` for all Phase 4 and Phase 5 plan entries
7. Phase 6 has its plan listed in ROADMAP
8. `grep -rn "discovery-phase\|verify-phase"` across repo (excluding .planning/, .git/, _archive/) returns ZERO
9. Same grep across `~/.claude/mowism/` (excluding _archive/) returns ZERO
10. `node --test bin/mow-tools.test.cjs` passes all tests
</verification>

<success_criteria>
- INT-02 closed: discovery-phase.md archived with header explaining it was never wired into plan-phase.md
- INT-03 closed: verify-phase.md archived with header explaining refine-phase.md replaced it
- ROADMAP.md Phase 4 and 5 checkboxes all [x], Phase 6 plan listed
- Zero stale references in active source files (templates, workflows, help, commands, agents, tooling)
- Both repo and installed copies are in sync
- Test suite green
</success_criteria>

<output>
After completion, create `.planning/phases/06-cleanup-orphaned-workflows/06-01-SUMMARY.md`
</output>
