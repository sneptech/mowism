# Feature Landscape: v1.2 Native Worktrees & Full-Lifecycle Workers

**Domain:** Multi-agent CLI orchestration -- native worktree adoption, full-lifecycle autonomous workers, auto-advance pipeline, GSD upstream bugfix ports
**Researched:** 2026-02-24
**Confidence:** MEDIUM-HIGH (Claude Code worktree APIs verified via official docs; competitor patterns confirmed via multiple sources; GSD upstream diff verified from local fork analysis)
**Scope:** NEW features for v1.2 only. Existing v1.0/v1.1 features documented in `FEATURES.md` and `v1.1-FEATURES.md`.

## Context

Mowism v1.1 shipped with DAG-based phase scheduling, multi-phase execution across worktrees, live feedback dashboard, and single-writer state protocol. v1.2 addresses three architectural gaps and one maintenance need:

1. **Native worktree adoption** -- replace custom `cmdWorktreeCreate` / `.worktrees/` with Claude Code's `--worktree` / `isolation: worktree` (ship since v2.1.49-50)
2. **Full-lifecycle workers** -- phase workers currently only execute; they should chain discuss -> research -> plan -> execute -> refine autonomously
3. **Auto-advance pipeline** -- `/mow:auto` chains phases without manual intervention; discuss phase ALWAYS pauses for user input (hard constraint)
4. **GSD upstream bugfix ports** -- 9 confirmed bugs from GSD v1.11-v1.20.6 that also exist in Mowism

Each section below categorizes features as table stakes, differentiators, or anti-features based on what the ecosystem (Claude Code native, GSD upstream, Cursor 2.0, Google ADK, OpenHands, LangGraph) actually does.

---

## 1. Native Worktree Adoption

Replacing Mowism's custom worktree management with Claude Code's built-in worktree isolation, while preserving Mowism's coordination layer (claiming, manifest, merge orchestration, shared state).

### What Claude Code Provides Natively (v2.1.49+)

| Capability | How It Works | Mowism Impact |
|-----------|-------------|---------------|
| `claude --worktree <name>` | Creates `.claude/worktrees/<name>/`, branches from default remote | Replaces `cmdWorktreeCreate`'s git worktree add |
| `isolation: worktree` in YAML frontmatter | Subagent auto-creates worktree, auto-cleans on completion if no changes | Replaces custom worktree creation for subagent spawns |
| `WorktreeCreate` / `WorktreeRemove` hooks | Custom logic on worktree lifecycle events | Mowism can inject `.planning/` copy, STATUS.md init, manifest updates |
| Auto-cleanup on exit | No changes = auto-remove; changes = prompt keep/remove | Replaces custom stale worktree cleanup |
| Worktree naming | Auto-generates or uses provided name | Map phase number to worktree name: `phase-09` |
| `.claude/worktrees/` in `.gitignore` | Prevents worktree content from appearing as untracked | Already standard practice |

### What Claude Code Does NOT Provide

| Missing Capability | Why It Matters | Mowism Must Keep |
|-------------------|---------------|-----------------|
| Phase-to-worktree tracking | Multiple phases run simultaneously; need to know which worktree owns which phase | `cmdWorktreeClaim` / `cmdWorktreeRelease` + STATE.md Worktree Assignments table |
| Claim/conflict prevention | Two workers should not execute the same phase | Advisory claim system in STATE.md |
| Merge orchestration | Parallel phase branches must merge in dependency order | `cmdWorktreeMerge` with DAG-aware ordering |
| `.planning/` state copy | New worktrees need `.planning/` from main for context | WorktreeCreate hook injects this |
| STATUS.md initialization | Workers need per-phase status tracking | WorktreeCreate hook initializes |
| Worktree manifest | Track all worktrees, their phases, stash state, merge status | Manifest JSON persists coordination metadata |
| Stash/restore on reuse | Resume a previously-stashed worktree | Keep stash logic in manifest |

### Table Stakes

Features that ANY tool adopting Claude Code's native worktree support must implement.

| Feature | Why Expected | Complexity | Depends On | Notes |
|---------|--------------|------------|------------|-------|
| **Use `--worktree` instead of `git worktree add`** | Claude Code's native flag handles branch creation, directory placement at `.claude/worktrees/`, and exit cleanup. Custom `git worktree add` to `.worktrees/` is now nonstandard and loses native integration. Cursor 2.0 and ccswarm both use the platform's worktree mechanism. | LOW | None | Path changes from `.worktrees/pNN` to `.claude/worktrees/phase-NN`. Update all path references in mow-tools.cjs and agent prompts. |
| **Use `isolation: worktree` for subagent isolation** | Subagents with `isolation: worktree` in YAML frontmatter get auto-created worktrees with auto-cleanup. This is the intended pattern per Anthropic docs and Boris Cherny's workflow guidance. Cursor and OpenHands both use platform-native isolation for parallel agents. | LOW | Agent YAML frontmatter | Add `isolation: worktree` to mow-executor, mow-verifier, and other subagent definitions. |
| **Hook into WorktreeCreate for state setup** | Native worktree creation does not copy `.planning/` or initialize STATUS.md. Without hooks, newly created worktrees lack project context. The WorktreeCreate hook is the official extension point for this (v2.1.50). | MEDIUM | WorktreeCreate hook support | Hook script: copy `.planning/`, init STATUS.md, register in manifest. Replaces inline logic in `cmdWorktreeCreate`. |
| **Hook into WorktreeRemove for cleanup** | Auto-cleanup on worktree exit may leave stale manifest entries, orphaned STATUS.md references, or unreleased claims. WorktreeRemove hook is the official teardown point. | LOW | WorktreeRemove hook support | Hook script: remove manifest entry, release phase claim, clear dashboard state for this phase. |
| **Update all path references** | Path changes from `.worktrees/pNN` to `.claude/worktrees/phase-NN` affect: mow-tools.cjs (manifest, claim, merge, status, clean commands), mow-team-lead.md, mow-phase-worker.md, execute-phase.md (multi_phase_check detection), and any path-based worktree detection logic. | MEDIUM | Path decision finalized | Grep for `.worktrees/` across all files. Estimate ~30-40 path references. |

### Differentiators

Features that set Mowism apart from other tools adopting native worktrees.

| Feature | Value Proposition | Complexity | Depends On | Notes |
|---------|-------------------|------------|------------|-------|
| **Coordination layer preserved over native primitives** | Cursor 2.0 uses worktrees but has no coordination -- 8 agents work in flat parallel with no dependency awareness, no merge ordering, no state coherence. OpenHands uses worktrees per agent but has no phase lifecycle or merge strategy. ccswarm uses worktrees but no planning layer. Mowism uniquely layers claiming, DAG-aware merge, and manifest tracking OVER native worktree primitives. This is the "orchestration on top of isolation" pattern no competitor implements. | Already built (v1.1) | Native worktree adoption | The coordination layer (claim, merge, manifest, STATUS.md) stays. Only the worktree creation/deletion mechanism changes. |
| **WorktreeCreate hook as extension point for teams** | By using hooks rather than custom code, other tools or users can extend worktree setup without modifying Mowism internals. No competitor offers hookable worktree lifecycle for multi-agent orchestration. Google ADK has `before_agent_callback` but it does not create isolated workspaces. | LOW | Hook system working | Hook script is a simple bash script registered in `.claude/settings.json` or `.claude/settings.local.json`. |
| **Graceful migration from `.worktrees/` to `.claude/worktrees/`** | Existing v1.1 projects have worktrees at `.worktrees/`. Migration must detect old paths, offer to move or recreate, and update manifest entries. No competitor handles worktree path migration because none had custom paths before. | MEDIUM | Path change decision | Migration script in `mow-tools.cjs`: detect old `.worktrees/` entries, warn user, offer `mow-tools worktree migrate`. |

### Anti-Features

| Anti-Feature | Why Avoid | What to Do Instead |
|--------------|-----------|-------------------|
| **Keeping both custom and native worktree paths** | Maintaining `.worktrees/` alongside `.claude/worktrees/` doubles path logic and creates confusion about which is authoritative. It fragments the ecosystem. | Full migration to `.claude/worktrees/`. Remove `.worktrees/` support after migration period (one minor release). |
| **Reimplementing worktree creation when hooks suffice** | The WorktreeCreate hook provides the exact extension point needed. Wrapping `claude --worktree` in custom code that recreates what the flag already does adds a maintenance burden for no benefit. | Use `claude --worktree` directly (via Task() with worktree config). Use hooks for Mowism-specific setup. |
| **Auto-cleanup for phase worktrees** | Claude Code's default auto-cleanup removes worktrees with no changes on exit. Phase worktrees ALWAYS have changes (STATUS.md, SUMMARY.md). Auto-remove on exit could destroy uncommitted work if exit happens before commit. | Keep explicit `cmdWorktreeMerge` + `cmdWorktreeRelease` flow. Phase worktrees are merged and removed by the lead, not auto-cleaned. |

---

## 2. Full-Lifecycle Workers

Phase workers currently run only execute-phase. v1.2 upgrades them to run the full lifecycle: discuss -> research -> plan -> execute -> refine autonomously, with user input pauses only at discuss-phase.

### Competitor Analysis

| System | Worker Autonomy | Lifecycle | Notes |
|--------|----------------|-----------|-------|
| **GSD upstream** | Single-stage only (executor, researcher, planner are separate commands) | User manually chains discuss -> plan -> execute | No autonomous lifecycle |
| **Cursor 2.0** | Task-scoped (one prompt = one agent session) | No lifecycle concept -- each agent gets a single task | Flat parallelism, no chaining |
| **Google ADK SequentialAgent** | Full pipeline -- sub-agents run sequentially without user input | SequentialAgent chains sub-agents automatically; output of one feeds next | Closest analog to full-lifecycle workers |
| **OpenHands** | Delegation-based -- parent agent delegates subtasks | AgentDelegateAction hands off to specialized agents; blocking | No lifecycle concept, task-scoped |
| **Anthropic multi-agent research** | 2-level (Opus lead + Sonnet workers) | Workers do one task, report back | No autonomous chaining |
| **Mowism v1.1** | Execute-only | Lead spawns workers for execute-phase only; discuss/plan run manually before | Partial lifecycle |
| **Mowism v1.2 (target)** | Full lifecycle | Worker chains discuss -> research -> plan -> execute -> refine via sequential Task() calls | Full lifecycle with mandatory discuss pause |

### Table Stakes

| Feature | Why Expected | Complexity | Depends On | Notes |
|---------|--------------|------------|------------|-------|
| **Worker chains discuss -> plan -> execute sequentially** | Google ADK's SequentialAgent established that pipeline stages should chain automatically. Users expect "start phase" to mean "do everything needed for this phase," not "do just execution." GSD upstream's manual chaining is the baseline Mowism must beat. | MEDIUM | mow-phase-worker.md rewrite | Worker already has Steps 1-5 in its lifecycle. The discuss/plan steps exist but are stubs -- they check for CONTEXT.md/PLAN files but do not actually invoke the workflows as Task() subagents. v1.2 makes them real. |
| **Context passing between lifecycle stages** | Each subagent (researcher, planner, executor) starts fresh. The phase worker must pass relevant outputs forward: CONTEXT.md path -> researcher, RESEARCH.md path -> planner, PLAN.md paths -> executor. Google ADK passes session.state between SequentialAgent stages; Mowism passes file paths. | LOW | Sequential Task() calls | Phase worker reads subagent output (file created), extracts relevant path/content, includes in next subagent prompt. Already documented in v1.2-NESTED-DELEGATION.md. |
| **Resume-awareness at each stage** | If a worker crashes mid-plan, it must detect what stage it was in (discuss done? plans created? which plans executed?) and resume from the correct point. Every CI/CD pipeline (Airflow, Prefect) supports idempotent resume. Phase workers already check for CONTEXT.md, PLAN files, SUMMARY files -- this just needs to be robust. | MEDIUM | Existing file-based state detection | Enhance Step 1 (Initialize) to detect exact resume point: which CONTEXT.md, which PLANs, which SUMMARYs exist. Skip completed stages. |
| **Mandatory discuss-phase pause for user input** | Hard constraint from v1.2 scope definition. Discuss-phase extracts implementation decisions from the user -- it CANNOT be automated because the user IS the domain expert. Google ADK's SequentialAgent has no concept of mandatory pauses; it runs fully automated. LangGraph's "breakpoint" pattern is the closest analog. This is table stakes for Mowism because the discuss phase's value proposition depends on human input. | LOW | Existing `input_needed` message | Worker sends `input_needed` to lead when discuss-phase starts. User switches to worker terminal, interacts with discuss-phase. After CONTEXT.md created, worker continues autonomously. Already partially implemented in mow-phase-worker Step 2. |

### Differentiators

| Feature | Value Proposition | Complexity | Depends On | Notes |
|---------|-------------------|------------|------------|-------|
| **Nested subagent delegation within workers** | Phase workers spawn specialized subagents (researcher, planner, executor, refiner) via Task(). This creates a 3-level hierarchy: lead -> workers -> subagents. No competitor does this -- Cursor is flat, GSD is 2-level, OpenHands delegates but does not chain. Google ADK supports arbitrary depth but recommends shallow. Anthropic's own system is 2-level. The confirmed architecture (v1.2-NESTED-DELEGATION.md) is novel. | HIGH | Agent Teams + Task() API | Workers are `general-purpose` teammates with Task() access. Subagents are specialized (`mow-executor`, `mow-phase-researcher`, etc.) without Task(). Verified: teammates CAN use Task(), subagents CANNOT. |
| **Research phase before planning** | Workers optionally run `/mow:research-phase` before planning. This is phase-specific domain research (not project-level). GSD has this as a manual step; no competitor automates it as part of a pipeline. The researcher subagent reads CONTEXT.md and roadmap phase goals to produce RESEARCH.md, which the planner consumes. | MEDIUM | mow-phase-researcher agent, research-phase workflow | Already exists as a workflow and agent. Worker just needs to invoke it via Task() between discuss and plan stages. |
| **Refine phase after execution** | Workers optionally run `/mow:refine-phase` after execution. This is Mowism's signature quality gate -- tiered checks (minimum/complex/algorithmic) with parallel quality subagents. No competitor has automated quality gates within a worker lifecycle. GSD verifies per-phase; Mowism refines. | MEDIUM | refine-phase workflow, quality-check skills | Already exists. Worker invokes as final Task() call. Refine results written to VERIFICATION-CHAIN file. Consider: always run minimum tier, make complex/algorithmic configurable. |
| **Stage transition messaging** | Workers send `stage_transition` messages as they move between lifecycle stages (discussing -> planning -> executing -> verifying). The lead's dashboard shows which stage each worker is in. No competitor provides this granularity -- Cursor shows only running/done, GSD shows nothing (single-session). | LOW | Already implemented in v1.1 | Message format and dashboard rendering already exist. Workers just need to send `stage_transition` at each new stage transition in the full lifecycle. |
| **Cost-aware model routing per stage** | Research subagent uses Haiku (read-only, cheap). Planner uses default model. Executor uses executor_model profile. Refiner uses verifier_model profile. This optimizes the 4-5 subagent spawns per worker for cost. Anthropic's own system uses Sonnet for workers, Opus for lead -- same principle. | LOW | Model profile system (exists) | Pass model parameter in each Task() call. Already supported in execute-phase subagent spawns. Extend to research/plan/refine subagent spawns. |

### Anti-Features

| Anti-Feature | Why Avoid | What to Do Instead |
|--------------|-----------|-------------------|
| **Skipping discuss-phase in auto mode** | The user confirmed this as a HARD CONSTRAINT. Discuss-phase captures implementation decisions the user cares about. Auto-skipping it produces generic implementations that miss the user's vision. GSD's auto-advance skips discussion -- this is a known user complaint. | Always pause at discuss-phase. Auto-advance resumes after discuss completes. |
| **Workers making architectural decisions autonomously** | During execution, Rule 4 deviations (architectural decisions) require user input. A fully autonomous worker that makes architectural decisions without user approval could commit to wrong database schemas, wrong API contracts, etc. Google ADK's autonomous agents are stateless; Mowism's workers produce permanent code changes. | Workers still pause for Rule 4 (architectural) deviations. Send `input_needed`, wait for user. Rules 1-3 (bug, missing critical, blocking) remain auto-handled. |
| **Context window bloat from collecting all stage outputs** | A worker that accumulates CONTEXT.md + RESEARCH.md + 4 PLANs + 4 SUMMARYs + VERIFICATION-CHAIN in its context will exhaust its 200k window. The UC Berkeley MAS failure taxonomy identifies context rot as the #1 multi-agent failure mode. | Workers pass file PATHS between stages, not file contents. Each subagent reads files fresh with its own 200k window. Worker context stays at ~15% -- only orchestration metadata. |
| **4+ levels of agent nesting** | v1.2-NESTED-DELEGATION.md confirms: "No production system uses 3+ levels -- cost/failure modes escalate super-linearly." Workers spawning subagents that spawn sub-subagents (4 levels) would cause OOM and is blocked by Claude Code (subagents cannot spawn subagents since v1.0.64). | Strict 3-level max: lead -> worker -> subagent. Workers use Task(). Subagents use tools directly. No deeper nesting. |

---

## 3. Auto-Advance Pipeline

`/mow:auto` chains phases automatically. Currently, auto-advance is per-stage (discuss -> plan -> execute within a phase). v1.2 extends it to cross-phase: after phase N completes (execute + verify), automatically start phase N+1 (discuss -> plan -> execute -> ...).

### Competitor Analysis

| System | Auto-Advance Capability | Pause Gates | Notes |
|--------|------------------------|-------------|-------|
| **GSD upstream v1.19.1+** | `--auto` flag chains discuss -> plan -> execute within a phase. `workflow.auto_advance` config persists across sessions (survives context compaction). Wired from `/gsd:new-project --auto` through full chain. | None -- fully automated when enabled | No cross-phase auto-advance. No mandatory pause gates. |
| **Google ADK SequentialAgent** | Runs all sub-agents in sequence without stopping. No user interaction points. | None built-in. Must use custom `before_agent_callback` to inject pauses. | Pipeline pattern but no gates. |
| **LangGraph** | Graph execution with conditional edges. Can auto-advance through nodes. | First-class "breakpoint" support -- graph pauses, human inspects state, edits memory, clicks resume. The reference implementation for pause gates. | Most sophisticated pause gate in the ecosystem. |
| **Airflow/Prefect** | DAG scheduler auto-advances through task graph as dependencies resolve. | `BranchPythonOperator` and manual approval tasks can pause pipelines. | Industry standard for pipeline orchestration with gates. |
| **Cursor 2.0** | No pipeline concept -- each agent is a one-shot task. | N/A | No chaining. |
| **Mowism v1.1** | Per-stage auto-advance within a phase (discuss -> plan -> execute). `--auto` flag on each command. `workflow.auto_advance` config. Cross-phase transition is manual (offer_next step presents options). | No mandatory pauses in auto mode. Discuss-phase runs but does not require user input in auto mode. | Partial -- intra-phase only. |
| **Mowism v1.2 (target)** | Full cross-phase auto-advance. After phase N completes (execute + verify passes), auto-start phase N+1 lifecycle. DAG-aware: only advance to phases whose dependencies are satisfied. | Mandatory discuss-phase pause. Auto-advance pauses when discuss needs user input, resumes after CONTEXT.md created. | Cross-phase with mandatory gates. |

### Table Stakes

| Feature | Why Expected | Complexity | Depends On | Notes |
|---------|--------------|------------|------------|-------|
| **`/mow:auto` command that starts the full pipeline** | GSD upstream has `--auto` on individual commands. Users expect a single entry point that says "run everything." Every CI/CD tool (GitHub Actions, Airflow, Prefect) has a "trigger pipeline" action. `/mow:auto` should accept a phase range or "all remaining" and chain them. | MEDIUM | Auto-advance config, transition.md updates | New command or flag: `/mow:auto [from-phase] [to-phase]` or `/mow:auto --all`. Sets `workflow.auto_advance` and invokes first phase. |
| **Cross-phase transition in auto mode** | Currently, `transition.md` offers next phase as a suggestion. In auto mode, it should invoke the next phase's lifecycle automatically. GSD's `--auto` propagates through `/gsd:discuss-phase {X+1} --auto`. Mowism's transition already has this partially -- yolo mode auto-invokes `/mow:discuss-phase [X+1] --auto` or `/mow:plan-phase [X+1] --auto`. | LOW | transition.md auto_advance step | Existing logic in transition.md `offer_next_phase` step already handles this for yolo mode. Extend to respect `workflow.auto_advance` config, not just `--auto` CLI flag. |
| **Auto-advance survives context compaction** | GSD learned this the hard way (fixed in v1.19.x): if `--auto` is only in the prompt context and the context gets compacted, auto-advance breaks. Must persist to `config.json` on disk. | LOW | Already implemented | discuss-phase already persists `--auto` to config: `node ~/.claude/mowism/bin/mow-tools.cjs config-set workflow.auto_advance true`. Verify all commands read from config, not just CLI flag. |
| **Auto-approve checkpoints in auto mode** | Plans with `autonomous: false` have checkpoints that pause for user verification. In auto mode, `human-verify` checkpoints should auto-approve and `decision` checkpoints should auto-select the first option. `human-action` checkpoints ALWAYS pause (auth gates cannot be automated). | LOW | Already implemented | execute-phase `checkpoint_handling` step already handles this: reads `AUTO_CFG`, auto-approves human-verify, auto-selects first option for decisions. |
| **Milestone boundary stops auto-advance** | When all phases in a milestone complete, auto-advance MUST stop. Users need to review, audit, and start the next milestone deliberately. GSD does not have milestone boundaries (it is project-scoped, not milestone-scoped). Airflow's DAG runs have defined boundaries. | LOW | transition.md Route B | Already implemented: transition.md Route B clears `workflow.auto_advance` and presents `/mow:complete-milestone`. |

### Differentiators

| Feature | Value Proposition | Complexity | Depends On | Notes |
|---------|-------------------|------------|------------|-------|
| **DAG-aware auto-advance** | When auto-advancing across phases, respect the DAG. If Phase 5 depends on Phases 2 and 3, auto-advance should not start Phase 5 until both 2 and 3 complete. In multi-phase parallel execution, this means: when Phase 2 finishes, check if downstream phases are unblocked, auto-start them. No competitor combines auto-advance with DAG scheduling. GSD is linear. Cursor has no DAG. Google ADK's ParallelAgent is task-scoped, not phase-scoped. | MEDIUM | DAG scheduler (v1.1), multi-phase execution engine | Lead already handles DAG-aware downstream unblocking in multi_phase_flow Step 5. Auto-advance in this context means: when a wave completes and the next wave is unblocked, auto-spawn workers without user confirmation. |
| **Mandatory discuss-phase pause gate** | The HARD CONSTRAINT: auto-advance always pauses at discuss-phase for user input. This is Mowism's version of LangGraph's "breakpoint" -- the pipeline pauses, user provides implementation decisions, pipeline resumes. No other auto-advance system has a mandatory gate tied to a specific lifecycle stage. GSD's auto-advance runs discuss but does not require input. | LOW | input_needed message, discuss-phase workflow | Worker sends `input_needed` at discuss-phase start. Auto-advance pauses. User interacts in worker terminal. After CONTEXT.md created, auto-advance resumes for plan -> execute -> refine. |
| **Auto-advance progress visibility** | When running `/mow:auto`, the user should see a high-level progress view: which phases are done, which is running, which is next. This is the "I kicked off auto-mode and went to lunch -- what happened?" use case. The live dashboard (v1.1) already shows phase progress. Auto-advance adds cross-phase progress tracking. | LOW | Dashboard (v1.1) | Dashboard already renders Active Phases table and event log. Auto-advance adds: banner showing "AUTO-ADVANCE: Phase {N}/{total}", percentage through milestone. |
| **Partial auto-advance (phase range)** | `/mow:auto 3 7` runs phases 3 through 7 automatically, then stops. Useful when you want to auto-run infrastructure phases but manually control user-facing phases. Airflow supports selective DAG triggering with task ID ranges. No Claude Code orchestrator supports phase range auto-advance. | LOW | Command argument parsing | Parse two optional arguments: start phase, end phase. Set a "stop at" marker in config. Auto-advance checks before each cross-phase transition. |

### Anti-Features

| Anti-Feature | Why Avoid | What to Do Instead |
|--------------|-----------|-------------------|
| **Auto-advance skipping discuss-phase entirely** | The hard constraint. Discuss extracts user decisions. Auto-skipping it produces generic implementations. This is the explicit lesson from GSD's auto mode: users complained that auto-generated plans did not match their vision. | Pause at discuss. Always. Even in auto mode. Resume after CONTEXT.md created. |
| **Auto-advance without rate limit awareness** | Auto-advancing through 8 phases with 5 plans each = 40+ subagent spawns. Rate limits (token bucket, API rate limits) will throttle or error. Auto-advance without backoff creates cascading failures. | Add rate limit detection to auto-advance. If a subagent reports a rate limit error, pause auto-advance, wait, retry. Use existing error handling + exponential backoff. |
| **"Run entire project unattended" mode** | The fantasy of "press one button, come back to a finished product" ignores reality: auth gates, architectural decisions, test failures, merge conflicts all require human judgment. LangGraph learned this: even with breakpoints, you need a human in the loop. | Auto-advance chains standard operations. Non-standard situations (Rule 4 deviations, auth gates, human-action checkpoints) always pause for human input. Auto-advance is "auto for the boring parts, pause for the interesting parts." |
| **Auto-advance across milestones** | Milestones are deliberate boundaries. Auto-crossing them means starting new feature work without reviewing what was built. Every agile methodology has sprint boundaries for a reason. | Stop at milestone boundary. Clear `workflow.auto_advance`. Present `/mow:complete-milestone`. User starts next milestone manually. |

---

## 4. GSD Upstream Bugfix Ports

9 confirmed bugs from GSD v1.11-v1.20.6 that also exist in Mowism. These are not features -- they are correctness fixes. Detailed analysis in `v1.2-GSD-UPSTREAM-DIFF.md`.

### Table Stakes (Must Port)

All 9 bugs are table stakes. Users hit these in normal operation.

| Bug | What Breaks | Complexity | Priority |
|-----|------------|------------|----------|
| **STATE.md dollar sign corruption** (PR #701) | `String.replace()` treats `$1`/`$2` in decision text as backreferences, corrupting STATE.md | LOW | P1 -- data corruption |
| **Phase requirement IDs not propagating** (PR #702) | `{phase_req_ids}` template variable always empty; requirements tracking broken | MEDIUM | P1 -- traceability broken |
| **Feature branch created too late** (PR #512) | With `branching_strategy: "phase"`, discuss/plan commits land on main | LOW | P1 -- git hygiene |
| **Progress bar RangeError** (PR #715) | Orphaned SUMMARY files -> negative argument to `String.repeat()` -> crash | LOW | P1 -- crash |
| **Executor no attempt limit** (v1.19.2) | Executor loops indefinitely on failing task | LOW | P1 -- resource waste |
| **Plan-without-discuss / discuss-after-plans guards** (v1.20.0) | No guards against workflow misordering | LOW | P2 -- UX confusion |
| **Health --repair overwrites STATE.md without backup** (v1.20.5) | State destruction on repair | LOW | P1 -- data loss |
| **Subagents don't discover project CLAUDE.md** (v1.20.5) | Spawned subagents lack project context | MEDIUM | P2 -- quality degradation |
| **Todo marked done before work starts** (PR #543) | Todos move to `done/` before any work happens | MEDIUM | P2 -- tracking error |

### Should-Consider Ports

Items from GSD upstream that would benefit Mowism but are not critical. See `v1.2-GSD-UPSTREAM-DIFF.md` for full analysis.

| Item | Value | Complexity | v1.2 Recommendation |
|------|-------|------------|---------------------|
| Context window monitor hook (PR #638) | Warns at 35%/25% remaining -- valuable for long-running workers | MEDIUM | YES -- critical for full-lifecycle workers |
| Nyquist validation layer (PR #687) | Requires plan tasks to have verify commands | MEDIUM | DEFER -- nice-to-have, not blocking |
| Requirements tracking chain (v1.20.2-3) | Full requirement propagation through all agents | HARD | DEFER -- significant scope, v1.3 |
| mow-tools.cjs domain split (PR #691) | 8,200 lines -> 11 modules | HARD | DEFER -- maintenance, not functional |
| Discuss-phase gray area looping (v1.20.6) | Ambiguous preferences trigger follow-up probing | LOW | YES -- improves discuss quality |
| `--full` flag for /mow:quick (v1.20.0) | Enables plan-checking and verification for quick tasks | LOW | DEFER -- quick mode is secondary |

---

## Feature Dependencies (v1.2)

```
[Native Worktree Adoption]
    |
    +--requires--> Claude Code v2.1.49+ (--worktree flag)
    |
    +--requires--> Claude Code v2.1.50+ (WorktreeCreate/WorktreeRemove hooks)
    |
    +--enables--> [Full-Lifecycle Workers] (workers run in native worktrees)
    |
    +--enables--> [Auto-Advance Pipeline] (phase transitions use native worktree creation)
    |
    +--independent-of--> [GSD Bugfix Ports] (bugfixes apply regardless of worktree backend)

[Full-Lifecycle Workers]
    |
    +--requires--> [Native Worktree Adoption] (workers need worktree isolation)
    |
    +--requires--> mow-phase-worker.md rewrite (add research, plan, refine stages)
    |
    +--requires--> Existing agent definitions (mow-phase-researcher, mow-planner, mow-verifier)
    |
    +--enhances--> [Auto-Advance Pipeline] (workers chain stages, auto-advance chains phases)
    |
    +--independent-of--> [GSD Bugfix Ports]

[Auto-Advance Pipeline]
    |
    +--requires--> [Full-Lifecycle Workers] (auto-advance triggers full lifecycle per phase)
    |
    +--requires--> transition.md updates (cross-phase auto-advance)
    |
    +--requires--> DAG scheduler (v1.1) for DAG-aware cross-phase advance
    |
    +--independent-of--> [GSD Bugfix Ports]

[GSD Bugfix Ports]
    |
    +--independent-of--> All three feature areas
    |
    +--can-be-parallelized-with--> Any of the above
    |
    +--should-come-first--> Fixes correctness bugs that affect all subsequent development
```

### Dependency Summary

**GSD bugfix ports should come FIRST.** They fix correctness bugs (STATE.md corruption, crashes, infinite loops) that affect all subsequent development. Port these before building new features on top of buggy foundations.

**Native worktree adoption is the FOUNDATION.** Full-lifecycle workers and auto-advance both depend on workers running in worktrees. The worktree backend must be migrated before worker behavior changes.

**Full-lifecycle workers come BEFORE auto-advance.** Auto-advance chains full lifecycle per phase. If workers only execute (v1.1 behavior), auto-advance has nothing to chain beyond what already exists.

**Auto-advance is the CAPSTONE.** It requires both native worktrees and full-lifecycle workers to be complete. It is the last feature to build.

---

## MVP Recommendation (v1.2)

### Phase 1: GSD Bugfix Ports (parallel with Phase 2)

Port all 9 must-port bugs plus the 2 should-consider items marked YES:
- Dollar sign corruption, requirement IDs, feature branch timing, progress bar crash, executor attempt limit, workflow guards, health backup, subagent CLAUDE.md, todo state
- Context window monitor hook (critical for full-lifecycle workers)
- Discuss-phase gray area looping (improves discuss quality for mandatory pause)

**Rationale:** Fix correctness first. These bugs affect daily usage. The context window monitor is specifically critical because full-lifecycle workers will have long-running sessions.

### Phase 2: Native Worktree Adoption (parallel with Phase 1)

- Replace `cmdWorktreeCreate` with `claude --worktree` / `isolation: worktree`
- Implement WorktreeCreate/WorktreeRemove hooks for `.planning/` copy and STATUS.md init
- Update all path references from `.worktrees/pNN` to `.claude/worktrees/phase-NN`
- Migration script for existing `.worktrees/` projects
- Keep coordination layer (claim, merge, manifest) intact

**Rationale:** Infrastructure change. Path references permeate the codebase (~30-40 locations). Must be done cleanly before building on top.

### Phase 3: Full-Lifecycle Workers

- Rewrite mow-phase-worker.md to chain discuss -> research -> plan -> execute -> refine via Task()
- Implement mandatory discuss-phase pause with `input_needed` message
- Add resume-awareness for each stage (detect existing CONTEXT.md, PLANs, SUMMARYs)
- Add cost-aware model routing per stage
- Test context accumulation across 5 subagent spawns per worker

**Rationale:** Depends on native worktrees (Phase 2). The worker rewrite is the most complex change -- it fundamentally changes how phases are processed.

### Phase 4: Auto-Advance Pipeline

- `/mow:auto [from] [to]` command or flag
- Cross-phase transition auto-invocation in transition.md
- DAG-aware downstream phase auto-start in multi-phase mode
- Milestone boundary auto-stop
- Auto-advance progress banner in dashboard

**Rationale:** Capstone feature. Requires full-lifecycle workers (Phase 3) to be complete. Relatively simple -- mostly wiring together existing components.

---

## Feature Prioritization Matrix

| Feature | User Value | Implementation Cost | Risk | Priority |
|---------|------------|---------------------|------|----------|
| GSD bugfix ports (9 must-port) | HIGH (correctness) | LOW-MEDIUM | LOW | P1 |
| Context window monitor hook | HIGH (reliability) | MEDIUM | LOW | P1 |
| Native worktree path migration | HIGH (alignment with platform) | MEDIUM | MEDIUM (path breakage) | P1 |
| WorktreeCreate/Remove hooks | HIGH (state setup) | LOW | LOW | P1 |
| `isolation: worktree` in agent YAML | MEDIUM (cleaner code) | LOW | LOW | P1 |
| Full-lifecycle worker rewrite | HIGH (automation) | HIGH | HIGH (context accumulation) | P1 |
| Mandatory discuss-phase pause | HIGH (user value) | LOW | LOW | P1 |
| Resume-awareness per stage | HIGH (reliability) | MEDIUM | MEDIUM | P1 |
| Cost-aware model routing | MEDIUM (cost savings) | LOW | LOW | P1 |
| Cross-phase auto-advance | HIGH (automation) | MEDIUM | MEDIUM | P2 |
| DAG-aware auto-advance | MEDIUM (parallel efficiency) | MEDIUM | MEDIUM | P2 |
| `/mow:auto` command | MEDIUM (UX) | LOW | LOW | P2 |
| Partial auto-advance (phase range) | LOW (power user) | LOW | LOW | P3 |
| Graceful `.worktrees/` migration | MEDIUM (backward compat) | MEDIUM | LOW | P2 |
| Discuss-phase gray area looping | LOW (quality) | LOW | LOW | P3 |

**Priority key:**
- P1: Must have -- core v1.2 promise, validates the milestone's value proposition
- P2: Should have -- completes the vision, adds polish
- P3: Nice to have -- defer to end of milestone or v1.3

---

## Complexity Assessment Summary

| Feature Area | Table Stakes Complexity | Differentiator Complexity | Total Effort |
|-------------|------------------------|---------------------------|-------------|
| Native Worktree Adoption | LOW-MEDIUM (path updates, hooks) | LOW-MEDIUM (migration, extension point) | MEDIUM |
| Full-Lifecycle Workers | MEDIUM (chaining, resume, pause) | HIGH (nested delegation, cost routing) | HIGH |
| Auto-Advance Pipeline | LOW (persist config, checkpoint auto-approve) | MEDIUM (DAG-aware, phase range) | MEDIUM |
| GSD Bugfix Ports | LOW-MEDIUM (9 targeted fixes) | N/A | LOW-MEDIUM |
| **Total v1.2** | | | **HIGH** |

The bulk of the complexity is in full-lifecycle workers (rewriting the phase worker to chain 5 stages with context passing, resume-awareness, and mandatory pause gates). Native worktree adoption is medium effort due to pervasive path changes. Auto-advance is straightforward wiring. Bugfixes are isolated and low-risk.

---

## Ecosystem Reference

### How competitors handle the three v1.2 capabilities:

| System | Native Worktree Isolation | Full-Lifecycle Workers | Auto-Advance Pipeline |
|--------|--------------------------|----------------------|----------------------|
| **Claude Code (native)** | `--worktree`, `isolation: worktree`, WorktreeCreate/Remove hooks | N/A (provides primitives, not orchestration) | N/A |
| **GSD upstream** | None (single branch, no worktrees) | None (manual command chaining) | `--auto` per-command, intra-phase only |
| **Cursor 2.0** | Up to 8 agents with git worktrees, flat parallelism | None (single-task agents) | None (no pipeline concept) |
| **Google ADK** | None (agents share session state) | SequentialAgent chains sub-agents automatically | Workflow agents run without stopping; no built-in pause gates |
| **OpenHands** | Clones repo per agent, worktree-based isolation | AgentDelegateAction for subtask delegation, no lifecycle | None (task-scoped, no pipeline) |
| **LangGraph** | None (in-process, no filesystem isolation) | Graph nodes can represent stages | Graph execution with breakpoints (first-class pause gates) |
| **Airflow/Prefect** | N/A (data pipeline, not code agents) | DAG tasks chain automatically | DAG scheduler with approval operators |
| **ccswarm** | Worktree isolation per agent | None (single-task agents) | None |
| **Mowism v1.2 (target)** | Native Claude Code worktrees + coordination layer (claim, merge, manifest) | Full lifecycle: discuss -> research -> plan -> execute -> refine, with mandatory discuss pause | Cross-phase auto-advance with DAG awareness and mandatory pause gates |

### Key patterns adopted:

- **From Claude Code native:** `--worktree` flag, `isolation: worktree` frontmatter, WorktreeCreate/WorktreeRemove hooks
- **From Google ADK:** SequentialAgent pattern for full-lifecycle workers (chain sub-agents automatically)
- **From LangGraph:** Breakpoint pattern for mandatory discuss-phase pause (pipeline pauses at defined gate, human interacts, pipeline resumes)
- **From Airflow:** DAG-aware auto-advance (only start downstream phases when dependencies satisfied)
- **From GSD upstream:** `--auto` flag persistence to config (survives context compaction), per-stage chaining

### Key patterns rejected:

- **From Cursor 2.0:** Flat parallelism without coordination (Mowism adds claiming, merge ordering, state coherence)
- **From Google ADK:** Fully automated pipeline without pause gates (Mowism requires discuss pause)
- **From GSD upstream:** Manual command chaining per stage (Mowism automates the full lifecycle per worker)
- **From LangGraph:** In-process state management (Mowism uses filesystem + git for persistence)

---

## Confidence Notes

| Finding | Confidence | Source |
|---------|------------|--------|
| Claude Code `--worktree` and `isolation: worktree` behavior | HIGH | Official Claude Code docs (code.claude.com), Claude Code changelog v2.1.49-50, Boris Cherny's workflow posts |
| WorktreeCreate/WorktreeRemove hook availability | HIGH | Claude Code changelog v2.1.50, @ClaudeCodeLog on X |
| GSD upstream bugfix list | HIGH | Local fork analysis (`v1.2-GSD-UPSTREAM-DIFF.md`), verified against GSD changelog and PRs |
| Nested agent delegation architecture | HIGH | v1.2-NESTED-DELEGATION.md, verified via runtime tests |
| Google ADK SequentialAgent/ParallelAgent behavior | MEDIUM | Official ADK docs (google.github.io/adk-docs), multiple blog posts |
| Cursor 2.0 worktree behavior | MEDIUM | Official Cursor docs (cursor.com/docs/configuration/worktrees), multiple dev.to articles |
| OpenHands AgentDelegateAction | MEDIUM | Official OpenHands docs (docs.openhands.dev), GitHub repo |
| LangGraph breakpoint pattern | MEDIUM | Multiple WebSearch sources agree; not verified against official docs |
| Auto-advance GSD upstream behavior | MEDIUM | GSD changelog, newreleases.io, DeepWiki analysis |
| Cross-phase auto-advance patterns (general ecosystem) | LOW | WebSearch only, synthesized from multiple sources; specific implementations vary |

## Sources

### Verified (HIGH confidence)
- [Claude Code Common Workflows (worktree section)](https://code.claude.com/docs/en/common-workflows) -- official worktree documentation
- [Claude Code Changelog v2.1.50](https://x.com/ClaudeCodeLog/status/2025163354965266574) -- WorktreeCreate/WorktreeRemove hooks
- [Boris Cherny on worktree isolation](https://www.threads.com/@boris_cherny/post/DVAAoZ3gYut) -- creator's recommended workflow
- [Mowism v1.2-NESTED-DELEGATION.md](file://.planning/research/v1.2-NESTED-DELEGATION.md) -- confirmed 3-level hierarchy
- [Mowism v1.2-GSD-UPSTREAM-DIFF.md](file://.planning/research/v1.2-GSD-UPSTREAM-DIFF.md) -- 9 must-port bugs

### Corroborated (MEDIUM confidence)
- [Cursor Parallel Agents Docs](https://cursor.com/docs/configuration/worktrees) -- worktree isolation for up to 8 agents
- [Google ADK Workflow Agents](https://google.github.io/adk-docs/agents/workflow-agents/) -- SequentialAgent, ParallelAgent patterns
- [Google ADK Multi-Agent Systems](https://google.github.io/adk-docs/agents/multi-agents/) -- delegation, transfer between agents
- [OpenHands Sub-Agent Delegation](https://docs.openhands.dev/sdk/guides/agent-delegation) -- AgentDelegateAction
- [GSD Releases](https://github.com/gsd-build/get-shit-done/releases) -- auto-advance evolution v1.19-v1.20
- [Git Worktrees for AI Coding](https://dev.to/mashrulhaque/git-worktrees-for-ai-coding-run-multiple-agents-in-parallel-3pgb) -- ecosystem patterns
- [ccswarm multi-agent with worktrees](https://github.com/nwiizo/ccswarm) -- worktree isolation per agent

### WebSearch only (LOW confidence -- flag for validation)
- [Deloitte: AI Agent Orchestration 2026](https://www.deloitte.com/us/en/insights/industry/technology/technology-media-and-telecom-predictions/2026/ai-agent-orchestration.html) -- enterprise orchestration trends
- [Stack AI: Agentic Workflow Architectures 2026](https://www.stack-ai.com/blog/the-2026-guide-to-agentic-workflow-architectures) -- pipeline architecture patterns
- [Claude Code Git Worktree Support - SuperGok](https://supergok.com/claude-code-git-worktree-support/) -- worktree overview
