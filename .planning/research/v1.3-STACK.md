# Technology Stack: v1.3 tmux Multi-Agent Execution

**Project:** Mowism v1.3
**Researched:** 2026-02-25
**Overall confidence:** HIGH (verified against installed tmux 3.6a, Claude CLI 2.1.53, Node.js v25.4.0)

---

## 1. tmux Scripting API

**Confidence: HIGH** -- All commands verified against `tmux list-commands` on tmux 3.6a.

### Session Lifecycle

| Command | Purpose | Example |
|---------|---------|---------|
| `new-session -d -s NAME` | Create detached session | `tmux new-session -d -s mow-v1.3` |
| `kill-session -t NAME` | Destroy session + all panes | `tmux kill-session -t mow-v1.3` |
| `has-session -t NAME` | Check if session exists (exit code) | `tmux has-session -t mow-v1.3 2>/dev/null` |
| `attach-session -t NAME` | Attach to existing session | `tmux attach-session -t mow-v1.3` |

### Pane Lifecycle

| Command | Purpose | Example |
|---------|---------|---------|
| `split-window -h -t SES` | Split horizontally (left/right) | `tmux split-window -h -t mow:0 -e CLAUDECODE="" "claude ..."` |
| `split-window -v -t SES` | Split vertically (top/bottom) | `tmux split-window -v -t mow:0 -l 30%` |
| `new-window -n NAME` | New window (full tab) | `tmux new-window -n worker-3 -t mow -e CLAUDECODE="" "claude ..."` |
| `kill-pane -t TARGET` | Kill specific pane | `tmux kill-pane -t mow:0.2` |
| `respawn-pane -k -t TARGET` | Restart command in existing pane | `tmux respawn-pane -k -t mow:0.1 -e CLAUDECODE="" "claude ..."` |

### Environment Variable Override

**Critical:** Claude CLI sets `CLAUDECODE=1` in its environment. Spawning `claude` from within a Claude session (including from mow-tools.cjs running inside Claude Code) will fail with "cannot be launched inside another Claude Code session."

**Solution:** Use tmux's `-e` flag to override the environment:

```bash
# split-window, new-window, new-session all support -e
tmux split-window -h -e CLAUDECODE="" "claude --system-prompt 'your prompt'"

# For send-keys pattern (less preferred, but works):
tmux send-keys -t mow:0.1 "CLAUDECODE= claude --agent worker" C-m
```

The `-e VARIABLE=value` flag is supported on: `new-session`, `new-window`, `split-window`, `respawn-pane`, `display-popup`. Verified in tmux 3.6a.

### Sending Commands to Panes

| Command | Purpose | Example |
|---------|---------|---------|
| `send-keys -t TARGET KEY...` | Type into a pane | `tmux send-keys -t mow:0.1 "hello" C-m` |
| `send-keys -t TARGET C-c` | Send Ctrl+C (interrupt) | `tmux send-keys -t mow:0.1 C-c` |

**Known race condition (HIGH confidence):** `send-keys` can arrive before shell initialization completes in a new pane. Claude Code's own Agent Teams hit this bug (GitHub issue #23513). **Mitigation:** Use the shell-command argument to `split-window`/`new-window` instead of creating an empty pane + `send-keys`. When the command is passed directly, tmux waits for shell init before executing.

```bash
# GOOD: command passed directly, no race condition
tmux split-window -h -e CLAUDECODE="" "claude --system-prompt 'build the API'"

# BAD: race condition possible
tmux split-window -h
tmux send-keys -t mow:0.2 "claude --system-prompt 'build the API'" C-m
```

### Layout Management

| Layout | Description | Use Case |
|--------|-------------|----------|
| `main-vertical` | Large pane left, others stacked right | Orchestrator sidebar + worker panes |
| `main-vertical-mirrored` | Large pane right, others stacked left | Workers left, orchestrator right |
| `tiled` | Even distribution, rows + columns | All workers equal size |
| `even-horizontal` | Equal width columns | Side-by-side workers |
| `even-vertical` | Equal height rows | Stacked workers |

**Recommended for Mowism:** `main-vertical` with orchestrator in the main (left) pane.

```bash
# Set layout
tmux select-layout -t mow:0 main-vertical

# Control main pane width (percentage supported)
tmux set-option -w -t mow:0 main-pane-width 30%

# After adding/removing panes, reapply layout
tmux select-layout -t mow:0 main-vertical
```

### Pane Sizing

```bash
# Resize specific pane
tmux resize-pane -t mow:0.0 -x 40      # Set width to 40 columns
tmux resize-pane -t mow:0.0 -y 20      # Set height to 20 rows

# Percentage-based split
tmux split-window -h -l 70%             # New pane gets 70% width

# main-pane-width controls the main pane in main-vertical layout
tmux set-option -w -t mow:0 main-pane-width 30%
```

### Reading Pane Content

| Command | Purpose | Example |
|---------|---------|---------|
| `capture-pane -t TARGET -p` | Print pane visible content to stdout | `tmux capture-pane -t mow:0.1 -p` |
| `capture-pane -t TARGET -p -S -100` | Capture last 100 lines of scrollback | `tmux capture-pane -t mow:0.1 -p -S -100` |
| `pipe-pane -t TARGET "cat >>log"` | Stream pane output to file | `tmux pipe-pane -t mow:0.1 -o "cat >>~/mow-worker-1.log"` |

### Targeting Convention

tmux targets follow `SESSION:WINDOW.PANE` format:
- `mow` -- session named "mow"
- `mow:0` -- window 0 in session "mow"
- `mow:0.0` -- pane 0 of window 0 in session "mow"
- `mow:0.1` -- pane 1 of window 0 in session "mow"

### Querying Pane State

```bash
# List all panes with format variables
tmux list-panes -t mow:0 -F '#{pane_id} #{pane_pid} #{pane_dead} #{pane_dead_status} #{pane_title}'

# Get PID of process in a specific pane
tmux display-message -t mow:0.1 -p '#{pane_pid}'

# Check if pane process has exited
tmux display-message -t mow:0.1 -p '#{pane_dead}'  # Returns "1" if dead, "0" if alive
```

### Synchronization with wait-for

```bash
# Block until signaled (useful for orchestrator waiting on worker completion)
tmux wait-for worker-1-done          # Blocks until signaled

# Signal from another context (e.g., a hook when worker exits)
tmux wait-for -S worker-1-done       # Unblocks the waiter

# Locking (mutex for file coordination)
tmux wait-for -L state-mutex         # Acquire lock
# ... do work ...
tmux wait-for -U state-mutex         # Release lock
```

### Process Exit Detection via Hooks

```bash
# remain-on-exit keeps pane open after command exits
tmux set-option -p -t mow:0.1 remain-on-exit on

# pane-died hook fires when remain-on-exit is on and the process exits
tmux set-hook -t mow:0 pane-died 'run-shell "echo pane died: #{pane_id} status=#{pane_dead_status}"'

# pane-exited hook fires when the pane's process exits (whether or not remain-on-exit)
tmux set-hook -t mow:0 pane-exited 'run-shell "/path/to/callback.sh #{pane_id} #{pane_dead_status}"'
```

---

## 2. Claude CLI Invocation Patterns

**Confidence: HIGH** -- Verified against `claude --help` output from Claude CLI 2.1.53.

### Interactive Mode (Recommended for Worker Panes)

```bash
# Spawn interactive claude in a tmux pane with a system prompt
claude --system-prompt "You are working on Phase 3: API Server. Read .planning/phases/03/PLAN.md and execute it." \
  --agent worker \
  --permission-mode default

# With specific allowed tools
claude --system-prompt "..." \
  --allowed-tools "Bash Edit Read Write Grep Glob" \
  --add-dir /path/to/worktree
```

**Why interactive, not `--print`:** Workers need tool access (Bash, Edit, Read, Write). The `--print` flag runs in non-interactive mode where tool use IS available (confirmed: `--print` can use tools). However, `--print` exits after one response. For multi-step plan execution, workers need the full interactive session. The user can also manually intervene in interactive panes when permission prompts appear.

### Key Flags for Worker Spawning

| Flag | Purpose | Usage |
|------|---------|-------|
| `--system-prompt PROMPT` | Override default system prompt | Inject phase context, plan instructions |
| `--append-system-prompt PROMPT` | Add to default system prompt | Layer Mowism instructions on top of defaults |
| `--agent AGENT` | Use a named agent definition | Points to Mowism agent YAML |
| `--permission-mode MODE` | Control permission behavior | `default`, `acceptEdits`, `plan` |
| `--dangerously-skip-permissions` | Skip all permission checks | Sandboxed environments only |
| `--allowed-tools TOOLS` | Whitelist specific tools | Restrict worker capabilities |
| `--disallowed-tools TOOLS` | Blacklist specific tools | Prevent workers from using certain tools |
| `--add-dir DIRS` | Add directories to tool access | Worktree paths |
| `--session-id UUID` | Use specific session ID | Track/resume specific workers |
| `--resume ID` | Resume a previous session | Crash recovery |
| `--continue` | Continue most recent session | Shorthand for resume |
| `--model MODEL` | Override model | `sonnet`, `opus`, or full name |
| `--effort LEVEL` | Set effort level | `low`, `medium`, `high` |
| `--max-budget-usd AMOUNT` | Cost cap (print mode only) | Budget control for `--print` |
| `--worktree [NAME]` | Create git worktree | Isolation per worker |
| `--tmux` | Create tmux session for worktree | Requires `--worktree` |
| `--output-format FORMAT` | Output format (print mode) | `text`, `json`, `stream-json` |
| `--no-session-persistence` | Don't save session to disk | Ephemeral workers |

### The `--tmux` Flag (Built-in)

Claude CLI 2.1.53 has a built-in `--tmux` flag: "Create a tmux session for the worktree (requires --worktree). Uses iTerm2 native panes when available; use --tmux=classic for traditional tmux."

**Analysis:** This is designed for `claude --worktree --tmux` which creates BOTH a worktree AND a tmux session for it. This is Claude's own worktree+tmux integration, NOT what Mowism needs. Mowism manages its own worktrees and tmux sessions. We should NOT use `--tmux` -- we spawn `claude` directly in tmux panes we control.

### Recommended Worker Invocation Pattern

```bash
# Full invocation for a worker in a tmux pane
tmux split-window -h \
  -t mow:0 \
  -e CLAUDECODE="" \
  -e CLAUDE_CODE_ENTRYPOINT="cli" \
  -c "/path/to/worktree" \
  "claude \
    --system-prompt 'You are Mowism Worker for Phase 3. Execute the plan in .planning/phases/03/PLAN.md. When complete, write DONE to .planning/phases/03/STATUS.md.' \
    --agent execute \
    --allowed-tools 'Bash Edit Read Write Grep Glob'"
```

### Print Mode for Fire-and-Forget Tasks

```bash
# For one-shot tasks (e.g., status checks, summaries)
claude -p "Read .planning/phases/03/STATUS.md and summarize progress" \
  --output-format json \
  --max-budget-usd 0.50
```

### Session Resume for Crash Recovery

```bash
# Resume a specific session by ID
claude --resume SESSION_UUID

# Continue the most recent session in the current directory
claude --continue

# Fork a session (new ID but same history)
claude --resume SESSION_UUID --fork-session
```

---

## 3. Terminal Color Theming in tmux

**Confidence: HIGH** -- Verified against tmux 3.6a man page STYLES section.

### Per-Pane Border Colors

```bash
# Enable pane border status lines (shows text in borders)
tmux set-option -w -t mow:0 pane-border-status top

# Global border style (inactive panes)
tmux set-option -g pane-border-style "fg=colour240"

# Active pane border style
tmux set-option -g pane-active-border-style "fg=colour46,bold"

# Per-pane custom label in border (tmux 2.3+)
tmux set-option -w -t mow:0 pane-border-format \
  ' #{?pane_active,#[fg=colour46 bold],#[fg=colour240]}#{pane_title} '
```

### Per-Pane User Options for Labels

tmux 3.x supports per-pane user options (prefixed with `@`):

```bash
# Set custom metadata on a pane
tmux set-option -p -t mow:0.1 @mow-phase "Phase 3: API Server"
tmux set-option -p -t mow:0.1 @mow-color "colour42"
tmux set-option -p -t mow:0.1 @mow-status "running"

# Use in pane-border-format
tmux set-option -w -t mow:0 pane-border-format \
  ' #{?pane_active,#[fg=#{@mow-color} bold],#[fg=colour240]}#{@mow-phase} [#{@mow-status}] '
```

### Color Palette for Workers

Reuse the existing Mowism 256-color palette (from v1.1 research):

| Worker Index | Color Name | 256-Color Code | Hex | Purpose |
|--------------|------------|----------------|-----|---------|
| 0 (orchestrator) | Bright White | colour255 | #eeeeee | Dashboard/sidebar |
| 1 | Green | colour42 | #00d787 | Worker 1 |
| 2 | Yellow | colour220 | #ffd700 | Worker 2 |
| 3 | Blue | colour75 | #5fafff | Worker 3 |
| 4 | Magenta | colour207 | #ff5fff | Worker 4 |
| 5 | Cyan | colour80 | #5fd7d7 | Worker 5 |
| 6 | Orange | colour208 | #ff8700 | Worker 6 |
| 7+ | Cycle from 1 | | | Wrap around |

```bash
# Set per-worker pane border color
tmux set-option -p -t mow:0.1 @mow-color "colour42"
tmux select-pane -t mow:0.1 -T "Phase 3: API Server"  # Sets pane_title

# Or use pane-border-indicators for simpler active/inactive coloring
tmux set-option -w -t mow:0 pane-border-indicators colour
```

### Status Line Customization

```bash
# Session-level status line for Mowism dashboard
tmux set-option -t mow -g status-style "bg=colour235,fg=colour255"
tmux set-option -t mow -g status-left \
  "#[fg=colour46,bold] MOW #[default]| #{session_name} | "
tmux set-option -t mow -g status-left-length 40
tmux set-option -t mow -g status-right \
  "#[fg=colour240]%H:%M | Workers: #{window_panes} "
tmux set-option -t mow -g status-right-length 50
tmux set-option -t mow -g status-interval 5
```

### Pane Border Line Styles

```bash
# Use heavy lines for better visibility
tmux set-option -w -t mow:0 pane-border-lines heavy

# Or rounded corners (UTF-8)
tmux set-option -w -t mow:0 pane-border-lines rounded
```

---

## 4. File Watching / Polling for Coordination

**Confidence: HIGH** -- Verified `fs.watch` and `fs.watchFile` on Node.js v25.4.0 / Linux.

### Recommendation: `fs.watch` (Primary) + `fs.watchFile` Polling (Fallback)

**Use `fs.watch`** -- not chokidar, not inotifywait. Rationale:

| Option | Verdict | Why |
|--------|---------|-----|
| `fs.watch` | **USE THIS** | Built-in Node.js, uses Linux inotify, zero dependencies, recursive watching since Node v19.1.0, verified working on this system |
| `fs.watchFile` | Fallback only | Polling-based (CPU overhead), but guaranteed to work everywhere |
| chokidar | Skip | External dependency, Mowism is zero-dep Node.js. chokidar v4 wraps `fs.watch` anyway -- adds no value. |
| inotifywait | Skip | External binary, not installed by default, requires `inotify-tools` package. Bash-only, doesn't integrate with Node.js event loop. |

### Implementation Pattern for STATUS.md Watching

```javascript
const fs = require('fs');
const path = require('path');

function watchStatusFile(statusPath, callback) {
  // fs.watch is event-driven (inotify on Linux), not polling
  const watcher = fs.watch(statusPath, (eventType) => {
    if (eventType === 'change') {
      // Debounce: fs.watch can fire multiple times for one write
      clearTimeout(watcher._debounce);
      watcher._debounce = setTimeout(() => {
        const content = fs.readFileSync(statusPath, 'utf-8');
        callback(content);
      }, 100); // 100ms debounce
    }
  });

  watcher.on('error', (err) => {
    // Fallback to polling if inotify fails (e.g., limit reached)
    console.warn(`fs.watch failed for ${statusPath}, falling back to polling:`, err.message);
    watcher.close();
    fs.watchFile(statusPath, { interval: 1000 }, (curr, prev) => {
      if (curr.mtimeMs !== prev.mtimeMs) {
        const content = fs.readFileSync(statusPath, 'utf-8');
        callback(content);
      }
    });
  });

  return watcher;
}
```

### Watching Multiple Phase Directories

```javascript
function watchPhaseStatuses(planningDir, onStatusChange) {
  // Watch the phases directory recursively
  // Recursive fs.watch works on Linux since Node v19.1.0 (verified on v25.4.0)
  const phasesDir = path.join(planningDir, 'phases');

  const watcher = fs.watch(phasesDir, { recursive: true }, (eventType, filename) => {
    if (filename && filename.endsWith('STATUS.md')) {
      const phaseMatch = filename.match(/^(\d+)\//);
      if (phaseMatch) {
        const phaseNum = phaseMatch[1];
        const fullPath = path.join(phasesDir, filename);
        // Debounce per-phase
        clearTimeout(watcher[`_debounce_${phaseNum}`]);
        watcher[`_debounce_${phaseNum}`] = setTimeout(() => {
          try {
            const content = fs.readFileSync(fullPath, 'utf-8');
            onStatusChange(phaseNum, content);
          } catch (e) { /* file may have been deleted */ }
        }, 100);
      }
    }
  });

  return watcher;
}
```

### inotify Limits

On Linux, `fs.watch` uses inotify. The default limit is typically 8192 watches. For Mowism (watching <20 STATUS.md files), this is a non-issue. If users hit limits from other tools:

```bash
# Check current limit
cat /proc/sys/fs/inotify/max_user_watches
# Typically 65536+ on modern systems, 8192 on some
```

---

## 5. Process Management

**Confidence: HIGH** -- Verified against Node.js v25 child_process docs and tmux 3.6a.

### Strategy: tmux Manages Processes, Node.js Monitors State

**Do NOT spawn claude processes via `child_process.spawn()`.** Instead:

1. **tmux spawns claude** via `split-window`/`new-window` with shell-command argument
2. **tmux tracks PIDs** via `#{pane_pid}` format variable
3. **tmux detects exit** via `remain-on-exit` + `pane-died`/`pane-exited` hooks
4. **Node.js reads state** via `execSync('tmux display-message ...')` or STATUS.md files

Rationale: tmux naturally manages process lifecycles, provides PTY allocation (which `claude` needs for interactive mode), and handles signal forwarding. Node.js `child_process.spawn` would require PTY allocation via `node-pty` (external dependency) for interactive claude sessions.

### PID Tracking Pattern

```javascript
const { execSync } = require('child_process');

function getPanePid(sessionName, windowIndex, paneIndex) {
  try {
    const pid = execSync(
      `tmux display-message -t "${sessionName}:${windowIndex}.${paneIndex}" -p '#{pane_pid}'`,
      { encoding: 'utf-8', stdio: ['pipe', 'pipe', 'pipe'] }
    ).trim();
    return pid ? parseInt(pid, 10) : null;
  } catch {
    return null; // Pane doesn't exist
  }
}

function isPaneDead(sessionName, windowIndex, paneIndex) {
  try {
    const dead = execSync(
      `tmux display-message -t "${sessionName}:${windowIndex}.${paneIndex}" -p '#{pane_dead}'`,
      { encoding: 'utf-8', stdio: ['pipe', 'pipe', 'pipe'] }
    ).trim();
    return dead === '1';
  } catch {
    return true; // Pane doesn't exist = dead
  }
}

function getPaneExitStatus(sessionName, windowIndex, paneIndex) {
  try {
    const status = execSync(
      `tmux display-message -t "${sessionName}:${windowIndex}.${paneIndex}" -p '#{pane_dead_status}'`,
      { encoding: 'utf-8', stdio: ['pipe', 'pipe', 'pipe'] }
    ).trim();
    return status ? parseInt(status, 10) : null;
  } catch {
    return null;
  }
}
```

### Exit Detection via tmux Hooks

```bash
#!/bin/bash
# Set up exit detection for a worker pane
SESSION="mow"
PANE_TARGET="$SESSION:0.1"
CALLBACK="/path/to/mow-tools.cjs"

# Keep pane open after process exits so we can read exit status
tmux set-option -p -t "$PANE_TARGET" remain-on-exit on

# Register hook: when process in pane dies, notify the orchestrator
tmux set-hook -t "$SESSION" pane-died \
  "run-shell '$CALLBACK tmux-worker-died #{pane_id} #{pane_dead_status}'"
```

### Alternative: Polling Loop (Simpler, More Portable)

```javascript
function pollPaneStatus(sessionName, paneTargets, interval, onDied) {
  const timer = setInterval(() => {
    for (const target of paneTargets) {
      if (isPaneDead(sessionName, target.window, target.pane)) {
        const exitStatus = getPaneExitStatus(sessionName, target.window, target.pane);
        onDied(target, exitStatus);
        // Remove from watch list
        paneTargets.splice(paneTargets.indexOf(target), 1);
        if (paneTargets.length === 0) clearInterval(timer);
      }
    }
  }, interval || 2000); // Poll every 2 seconds
  return timer;
}
```

### Signal Handling for Graceful Shutdown

```javascript
function setupGracefulShutdown(sessionName) {
  const cleanup = () => {
    try {
      // Send Ctrl-C to all panes first (graceful)
      const panes = execSync(
        `tmux list-panes -t "${sessionName}" -F '#{pane_id}'`,
        { encoding: 'utf-8', stdio: ['pipe', 'pipe', 'pipe'] }
      ).trim().split('\n');

      for (const paneId of panes) {
        try {
          execSync(`tmux send-keys -t "${paneId}" C-c`, { stdio: 'pipe' });
        } catch { /* pane may already be dead */ }
      }

      // Wait briefly for graceful exit
      setTimeout(() => {
        try {
          execSync(`tmux kill-session -t "${sessionName}"`, { stdio: 'pipe' });
        } catch { /* session may already be gone */ }
      }, 3000);
    } catch { /* session doesn't exist */ }
  };

  process.on('SIGINT', cleanup);
  process.on('SIGTERM', cleanup);
  process.on('exit', cleanup);
}
```

### Process Lifecycle State Machine

```
PENDING  -->  SPAWNING  -->  RUNNING  -->  DONE (exit 0)
                  |              |              |
                  v              v              v
               FAILED        FAILED        FAILED (exit != 0)
                                |
                                v
                            STALLED (no STATUS.md update for N minutes)
```

Track this in STATUS.md per phase:
```markdown
## Worker Status
- **State:** RUNNING
- **PID:** 12345
- **Pane:** mow:0.1
- **Started:** 2026-02-25T14:30:00Z
- **Last activity:** 2026-02-25T14:35:00Z
```

---

## Recommended Stack (New Dependencies for v1.3)

### Core: Zero New Dependencies

| Technology | Version | Purpose | Why |
|------------|---------|---------|-----|
| tmux | 3.6a (installed) | Multi-pane terminal management | De facto standard, already on system, unmatched pane/session/hook API |
| Node.js `child_process.execSync` | Built-in (v25.4.0) | Execute tmux commands from orchestrator | Already used throughout mow-tools.cjs, synchronous is fine for tmux queries |
| Node.js `fs.watch` | Built-in (v25.4.0) | Watch STATUS.md file changes | Uses Linux inotify, zero deps, recursive support since v19.1 |
| Node.js `fs.watchFile` | Built-in (v25.4.0) | Fallback polling for file watches | Guaranteed to work even when inotify fails |
| Claude CLI | 2.1.53 | Worker agent processes | Already installed, `--system-prompt` + `--agent` for worker configuration |

### No New npm Dependencies

| Considered | Why Not |
|------------|---------|
| chokidar | Wraps `fs.watch` -- adds dependency for no benefit. Mowism watches <20 files. |
| node-pty | Would be needed if spawning interactive claude from Node.js directly. tmux provides the PTY instead. |
| blessed / ink | TUI libraries for the dashboard. Unnecessary -- the orchestrator pane uses plain ANSI output, tmux handles the layout. |
| tree-kill | Process tree killing. tmux `kill-session` handles this natively. |
| inotify-tools | System binary, not installed. `fs.watch` covers the need. |

### No New System Dependencies

tmux is the only system dependency, and it is already installed (v3.6a). No additional packages required.

---

## Integration Points with Existing mow-tools.cjs

### Where tmux Commands Fit

| Existing Function Area | Integration Point |
|------------------------|-------------------|
| `worktreeCreate()` (line ~6996) | After creating worktree, spawn tmux pane for worker |
| `worktreeRemove()` | Before removing worktree, kill tmux pane |
| DAG scheduler (Kahn's BFS) | When phase becomes ready, spawn worker in tmux pane |
| Status updates (`status` command) | Read tmux pane state + STATUS.md files |
| Notification system | Update tmux pane border colors on state changes |
| Progress dashboard | Orchestrator pane renders progress using existing 256-color output |

### New Functions Needed in mow-tools.cjs

```javascript
// tmux session management
tmuxCreateSession(name, cwd)           // new-session -d -s NAME -c CWD
tmuxKillSession(name)                  // kill-session -t NAME
tmuxHasSession(name)                   // has-session -t NAME (boolean)
tmuxAttach(name)                       // attach-session -t NAME

// pane management
tmuxSpawnWorker(session, phase, cwd, prompt)  // split-window with claude
tmuxKillPane(target)                   // kill-pane -t TARGET
tmuxSetLayout(session, layout, mainPaneWidth) // select-layout + main-pane-width

// pane state
tmuxGetPanePid(target)                 // display-message #{pane_pid}
tmuxIsPaneDead(target)                 // display-message #{pane_dead}
tmuxListPanes(session)                 // list-panes -F format

// pane decoration
tmuxSetPaneLabel(target, phase, color) // set-option -p @mow-phase, @mow-color
tmuxSetBorderFormat(session)           // pane-border-format with @mow-* vars
tmuxSetStatusLine(session)             // status-left, status-right

// coordination
tmuxWaitFor(channel)                   // wait-for CHANNEL (blocking)
tmuxSignal(channel)                    // wait-for -S CHANNEL

// file watching (not tmux, but coordination)
watchStatusFiles(planningDir, callback) // fs.watch recursive on phases/
```

---

## Alternatives Considered

| Category | Recommended | Alternative | Why Not |
|----------|-------------|-------------|---------|
| Terminal multiplexer | tmux | screen | screen lacks pane border styling, hooks, per-pane options, wait-for. tmux is the industry standard. |
| Terminal multiplexer | tmux | Zellij | Zellij is newer but has less scripting API, no equivalent of wait-for, less mature hooks. tmux is battle-tested. |
| Process spawning | tmux split-window | Node.js child_process.spawn | spawn doesn't allocate PTY (needed for interactive claude). Would need node-pty dependency. tmux provides PTY natively. |
| File watching | fs.watch | chokidar v4 | chokidar wraps fs.watch. Adds dependency for zero benefit on single-OS, <20 file use case. |
| File watching | fs.watch | inotifywait (bash) | System dependency not installed. Doesn't integrate with Node.js event loop. |
| Dashboard | Plain ANSI in tmux pane | blessed/ink TUI | External dependencies. tmux pane + ANSI escape codes (which Mowism already has) is sufficient. |
| Claude spawning | Interactive sessions | `--print` mode | `--print` exits after one response. Workers need multi-step tool-using sessions. |
| Claude spawning | `--system-prompt` | `--agent` YAML | Both work. `--system-prompt` is more flexible for dynamic prompts. `--agent` for standardized worker templates. Use both: `--agent execute --append-system-prompt "phase-specific context"`. |
| Layout | main-vertical | tiled | main-vertical gives orchestrator a dedicated sidebar. Tiled treats all panes equal, which loses the orchestrator/worker distinction. |

---

## Verified Versions

| Tool | Version | Verified |
|------|---------|----------|
| tmux | 3.6a | `tmux -V` on 2026-02-25 |
| Claude CLI | 2.1.53 | `claude --version` on 2026-02-25 |
| Node.js | v25.4.0 | `node -e "console.log(process.version)"` on 2026-02-25 |
| OS | Linux 6.18.9-2-cachyos | `uname -r` |

---

## Sources

**Verified (HIGH confidence):**
- tmux 3.6a man page (local: `man tmux`) -- all tmux commands, options, hooks, format variables
- Claude CLI 2.1.53 `--help` output -- all flags and descriptions
- Node.js v25.4.0 fs.watch/fs.watchFile -- tested live on this system
- tmux `list-commands` output -- confirmed all command signatures

**WebSearch-verified (MEDIUM confidence):**
- [Claude Code `--tmux` flag description](https://www.threads.com/@boris_cherny/post/DVAAoZ3gYut/) -- Boris Cherny (Anthropic engineer) describing --worktree + --tmux
- [tmux send-keys race condition](https://github.com/anthropics/claude-code/issues/23513) -- Agent Teams bug report confirming shell init timing issue
- [CLAUDECODE env var bypass](https://github.com/anthropics/claude-agent-sdk-python/issues/573) -- SDK issue confirming `CLAUDECODE=""` override pattern
- [tmux pane-border-format usage](https://github.com/tmux/tmux/issues/934) -- Official tmux issue documenting per-pane labels
- [tmux-agent-indicator](https://github.com/accessd/tmux-agent-indicator) -- Prior art for AI agent state visualization in tmux
- [cmux](https://github.com/craigsc/cmux) -- Prior art for Claude Code + tmux worktree management
- [claude-tmux](https://github.com/nielsgroen/claude-tmux) -- Prior art for Claude Code session management in tmux (Rust TUI)
- [Node.js child_process docs](https://nodejs.org/api/child_process.html) -- PID tracking, signal handling
- [Vite fs.watch discussion](https://github.com/vitejs/vite/issues/12495) -- Confirms fs.watch sufficiency for modern Node.js
